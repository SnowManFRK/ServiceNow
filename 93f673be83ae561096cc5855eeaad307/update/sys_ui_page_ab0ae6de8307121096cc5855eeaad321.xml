<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ui_page">
    <sys_ui_page action="INSERT_OR_UPDATE">
        <category>htmleditor</category>
        <client_script><![CDATA[// This will run on Click ok "Cancel" button
function onCancel() {
    GlideDialogWindow.get().destroy();
}

function updateGroup() {
    var environmentId = document.getElementById("environment").value;

	var automatedDeployment = document.getElementById("automate_deploy").value;
    var selectedUpdateSets = getUpdateSet();
    var reqId = g_form.getUniqueValue();

    if (environmentId && selectedUpdateSets && reqId) {

        var ga = new GlideAjax('CICDClientSideUtils');
        ga.addParam('sysparm_name', 'createDeployementTask');
        ga.addParam('sysparm_environment_id', environmentId);
        ga.addParam('sysparm_local_update_set_id', selectedUpdateSets);
		ga.addParam('sysparm_automate_deploy', automatedDeployment);
        ga.addParam('sysparm_req_id', reqId);
        ga.getXMLAnswer(function(response) {
            var answer = response.responseXML.documentElement.getAttribute('answer');
            // if (answer) {
                
                
            // }
        });
    }
	onCancel();
	GlideList2.get(g_form.getTableName() + '.x_601332_cicd_deployment_pack.deployment_request').setFilterAndRefresh('');
	GlideList2.get(g_form.getTableName() + '.x_601332_cicd_tasks.deployment_request').setFilterAndRefresh('');
	
}



function getUpdateSet() {
    var updateSet = [];
    var grList = gel('select_0update_set');
    var grListOptions = Array.from(grList);
    for (var x = 0; x < grListOptions.length; x++) {
        updateSet.push(grListOptions[x].value);
    }
    return updateSet.toString();
}]]></client_script>
        <description/>
        <direct>true</direct>
        <endpoint>x_601332_cicd_DeploymentRequest.do</endpoint>
        <html><![CDATA[<?xml version="1.0" encoding="utf-8" ?>
<j:jelly trim="false" xmlns:j="jelly:core" xmlns:g="glide" xmlns:j2="null" xmlns:g2="null">
    <div class="panel-heading panel-head-background" style="background-color:#2C3E50;color:white;margin-bottom:10px;font-size: 18px;padding: 15px 10px; border-radius: 8px 8px 0 0;">
        <center id="pageHeader">Deploy Update Sets</center>
    </div>
    <g:ui_form>
        <table style="width: 100%; border-collapse: collapse; padding: 20px; background-color: #ECF0F1; border-radius: 0 0 8px 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);">
            <tr>
                <td colspan="2" style="padding: 15px;">
                    <label for="environment" style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px; color: #2C3E50;">Environment</label>
                    <g:ui_reference 
                        name="environment" 
                        id="environment" 
                        table="x_601332_cicd_environment" 
                        query="" 
                        columns="name;type" 
                        style="width: 100%; padding: 10px; border: 1px solid #BDC3C7; border-radius: 4px; background-color: #ffffff; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);" />
                </td>
            </tr>
            <tr>
                <td colspan="2" style="padding: 15px;">
                    <label for="update_set" style="display: block; margin-bottom: 8px; font-weight: bold; font-size: 14px; color: #2C3E50;">Update Set</label>
                    <g:macro_invoke macro="lightweight_glide_list" id="update_set" name="update_set" control_name="update_set" reference="sys_update_set" can_write="true" columns="name,parent" style="width: 100%; padding: 10px; border: 1px solid #BDC3C7; border-radius: 4px; background-color: #ffffff; box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);" />
                </td>
            </tr>
            <tr>
                <td colspan="2" style="padding: 15px; display: flex; align-items: center;">
                    <label for="confirm_deploy" style="margin-right: 10px; font-weight: bold; font-size: 14px; color: #2C3E50;">Automated Deployment</label>
                    <g:ui_checkbox 
                        name="automate_deploy" 
                        id="automate_deploy" 
                        value="true" 
                        style="margin: 0; transform: scale(1.2);" />
                </td>
            </tr>
            <tr>
                <td colspan="2" style="text-align: right; padding: 15px;">
                    <div id="buttons_visible" style="display: flex; justify-content: flex-end; gap: 10px;">
                        <g2:dialog_buttons_ok_cancel 
                            ok="return updateGroup()" 
                            cancel="return onCancel()" 
                            ok_type="button" 
                            cancel_type="button" 
                            style="padding: 10px 20px; border: none; border-radius: 4px; background-color: #3498DB; color: white; cursor: pointer; font-size: 14px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);" />
                    </div>
                </td>
            </tr>
        </table>
    </g:ui_form>
</j:jelly>]]></html>
        <name>DeploymentRequest</name>
        <processing_script/>
        <sys_class_name>sys_ui_page</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-01-14 15:57:46</sys_created_on>
        <sys_id>ab0ae6de8307121096cc5855eeaad321</sys_id>
        <sys_mod_count>75</sys_mod_count>
        <sys_name>DeploymentRequest</sys_name>
        <sys_package display_value="CICD Pipeline" source="x_601332_cicd">93f673be83ae561096cc5855eeaad307</sys_package>
        <sys_policy/>
        <sys_scope display_value="CICD Pipeline">93f673be83ae561096cc5855eeaad307</sys_scope>
        <sys_update_name>sys_ui_page_ab0ae6de8307121096cc5855eeaad321</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-01-23 15:16:49</sys_updated_on>
    </sys_ui_page>
    <sys_es_latest_script action="INSERT_OR_UPDATE">
        <id>ab0ae6de8307121096cc5855eeaad321</id>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2025-01-14 15:57:44</sys_created_on>
        <sys_id>e95aaa5a8307121096cc5855eeaad31a</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2025-01-14 15:57:44</sys_updated_on>
        <table>sys_ui_page</table>
        <use_es_latest>true</use_es_latest>
    </sys_es_latest_script>
</record_update>
